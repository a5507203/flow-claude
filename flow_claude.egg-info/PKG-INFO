Metadata-Version: 2.4
Name: flow-claude
Version: 0.1.0
Summary: Git-driven autonomous development system using Claude agent SDK
Author: Flow-Claude Contributors
Requires-Python: >=3.10
Description-Content-Type: text/markdown
Requires-Dist: claude-agent-sdk>=0.1.0
Requires-Dist: click>=8.1.0
Provides-Extra: dev
Requires-Dist: pytest>=7.0.0; extra == "dev"
Requires-Dist: pytest-asyncio>=0.21.0; extra == "dev"
Requires-Dist: ruff>=0.1.0; extra == "dev"

# Flow-Claude

**Git-driven autonomous development using Claude agent SDK**

Flow-Claude is a fully autonomous development system that uses the Claude agent SDK to decompose development requests into fine-grained tasks, execute them via planning and worker agents, and store all metadata in git commits—no external files required.

## Features

- **Git-First Architecture**: All task metadata, execution plans, and state stored in git commits
- **Autonomous Multi-Agent System**: Planning agent orchestrates, worker agents execute
- **Fine-Grained Tasks**: 5-10 minute tasks for maximum parallelization and error isolation
- **Dynamic Replanning**: Adapts execution plan based on discoveries during implementation
- **Context-Aware Workers**: Workers understand session goals and task dependencies
- **Zero External Files**: No `.flow-claude/tasks/*.json` or configuration overhead

## Architecture

```
User Request
    ↓
Planning Agent
    ├─→ Creates execution plan (git branch)
    ├─→ Creates task branches with metadata (git commits)
    ├─→ Spawns worker agents
    └─→ Validates and merges completed tasks

Worker Agents
    ├─→ Read task metadata from git commits
    ├─→ Implement using Read/Write/Edit/Bash tools
    ├─→ Test implementation
    └─→ Signal completion via git commits
```

## Installation

### Prerequisites

- Python 3.10 or higher
- Node.js (for Claude Code CLI)
- Git repository (must be inside a git repo to use Flow-Claude)
- Claude Code CLI 2.0.0+ (handles authentication)

### Install from Source

```bash
# Clone the repository
git clone https://github.com/yourusername/flow-claude.git
cd flow-claude

# Install in development mode
pip install -e .

# Or install with dev dependencies
pip install -e ".[dev]"
```

### Authentication Setup

Flow-Claude uses **Claude Code CLI** for authentication. **No API key needed!**

**Step 1: Install Claude Code CLI**

```bash
npm install -g @anthropic-ai/claude-code
```

**Step 2: Log in to your Anthropic account**

```bash
claude-code auth login
```

This opens a browser for authentication. You only need to do this once!

**Step 3: Verify authentication**

```bash
claude-code auth status
```

**That's it!** Flow-Claude will use your Claude Code authentication automatically.

See **[AUTHENTICATION.md](AUTHENTICATION.md)** for detailed setup and troubleshooting.

## Usage

### Basic Usage

Navigate to your git repository and run:

```bash
flow-claude develop "add user authentication with email and password"
```

Flow-Claude will:
1. Analyze your codebase
2. Create an execution plan with fine-grained tasks
3. Spawn worker agents to implement each task
4. Validate and merge completed tasks
5. Handle any blocks or failures with dynamic replanning

### Command Options

```bash
flow-claude develop [OPTIONS] REQUEST

Options:
  --model [sonnet|opus|haiku]  Claude model to use (default: sonnet)
  --max-turns INTEGER          Maximum conversation turns (default: 100)
  --permission-mode [acceptEdits|ask|deny]
                              Permission mode for tool usage (default: acceptEdits)
  --help                      Show help message
```

### Examples

**Add authentication:**
```bash
flow-claude develop "add user authentication with JWT tokens"
```

**Refactor code:**
```bash
flow-claude develop "refactor database layer to use async/await"
```

**Fix bugs:**
```bash
flow-claude develop "fix the payment processing timeout issue"
```

**Use different model:**
```bash
flow-claude develop "implement GraphQL API" --model opus
```

## How It Works

### Phase 1: Planning

The planning agent:
1. Analyzes your codebase (reads README, source files, tests)
2. Breaks down request into 5-10 minute tasks
3. Determines task dependencies (preconditions and provides)
4. Creates a plan branch: `plan/session-YYYYMMDD-HHMMSS`
5. Commits execution plan with all task metadata

### Phase 2: Task Execution

For each task:
1. Planning agent creates task branch: `task/001-description`
2. Commits task metadata as first commit on branch
3. Worker agent spawns and:
   - Reads task metadata from git commit
   - Reads preconditions from main branch
   - Implements the task
   - Tests the implementation
   - Signals completion via `TASK_COMPLETE` commit

### Phase 3: Validation and Merge

Planning agent:
1. Detects `TASK_COMPLETE` signal via git polling
2. Validates task (runs tests, linting, type checking)
3. Merges to main with merge commit containing "Provides"
4. Spawns next tasks whose preconditions are now satisfied

### Phase 4: Dynamic Replanning

If worker signals `TASK_BLOCKED`:
1. Planning agent reads block details from git commit
2. Updates execution plan (new plan version)
3. Creates new task to resolve dependency
4. Resumes blocked task after dependency completes

## Git Structure

All data lives in git:

```
your-repo/
├── main branch
│   └── Merge commits with task results
├── task/* branches
│   ├── task/001-user-model
│   ├── task/002-password-hash
│   └── ... (deleted after merge)
└── plan/session-* branches
    └── plan/session-20250101-120000
        └── Execution plan commits (v1, v2, ...)
```

### Task Metadata (in git commit)

```
Initialize task/001-user-model

## Task Metadata
ID: 001
Description: Create User model with email and password fields
Status: pending

## Dependencies
Preconditions: []
Provides:
  - User model class
  - User.email field
  - User.password_hash field

## Files
Files to modify:
  - src/auth/models.py (create)
  - tests/test_models.py (create)

## Context
Session Goal: Add user authentication
Session ID: session-20250101-120000
Plan Branch: plan/session-20250101-120000
Plan Version: v1

## Estimates
Estimated Time: 8 minutes
Priority: high
```

## Development

### Running Tests

```bash
# Install dev dependencies
pip install -e ".[dev]"

# Run tests
pytest tests/ -v

# Run tests with coverage
pytest tests/ --cov=flow_claude --cov-report=html
```

### Code Quality

```bash
# Linting
ruff check flow_claude/

# Type checking
mypy flow_claude/

# Format code
ruff format flow_claude/
```

### Project Structure

```
flow-claude/
├── flow_claude/           # Main package
│   ├── __init__.py
│   ├── cli.py            # CLI entry point (~80 lines)
│   ├── agents.py         # Agent definitions (~50 lines)
│   ├── git_tools.py      # Custom MCP tools (~120 lines)
│   └── parsers.py        # Git parsing utilities (~150 lines)
├── prompts/              # System prompts (workflow logic)
│   ├── planner.md        # Planning agent workflow (~400 lines)
│   └── worker.md         # Worker agent workflow (~300 lines)
├── tests/                # Test suite
│   ├── test_parsers.py
│   ├── test_git_tools.py
│   └── test_cli.py
├── pyproject.toml        # Package configuration
├── README.md            # This file
├── DESIGN_V6.1.md       # Detailed design document
└── IMPLEMENTATION_PLAN.md  # Implementation guide
```

**Total Code:** ~400 lines Python + ~700 lines prompts

## Design Principles

### 1. Git as Single Source of Truth

- No external JSON/YAML files
- All metadata in git commits
- State synthesized from git log queries
- Immutable audit trail

### 2. Prompt-Driven Workflow

- Logic encoded in system prompts (planner.md, worker.md)
- Python is minimal glue code
- Agents follow workflows from prompts
- Easy to modify behavior by editing prompts

### 3. Ultra-Fine Task Granularity

- Tasks: 5-10 minutes each
- Atomic, testable, reversible
- Maximum parallelization opportunity
- Easy error isolation and recovery

### 4. Context-Aware Agents

- Workers understand session goals
- Workers read related tasks from plan
- Workers design interfaces for dependent tasks
- Workers follow patterns from completed tasks

### 5. Fully Autonomous Operation

- Self-correcting via continuous monitoring
- Dynamic replanning when needed
- Automatic error recovery
- Human intervention only for catastrophic failures

## Documentation

- **[DESIGN_V6.1.md](DESIGN_V6.1.md)**: Complete design document with architecture, workflows, and examples
- **[IMPLEMENTATION_PLAN.md](IMPLEMENTATION_PLAN.md)**: Step-by-step implementation guide using Claude agent SDK

## Troubleshooting

### "Not a git repository" error

Flow-Claude requires a git repository. Initialize one:

```bash
git init
git add .
git commit -m "Initial commit"
```

### Agent SDK import errors

Make sure you have the Claude agent SDK installed:

```bash
pip install claude-agent-sdk
```

### Claude Code CLI not found

Install Claude Code CLI and authenticate:

```bash
# Install
npm install -g @anthropic-ai/claude-code

# Log in
claude-code auth login

# Verify
claude-code auth status
```

See [AUTHENTICATION.md](AUTHENTICATION.md) for detailed troubleshooting.

### Tasks getting stuck

Check git branches for TASK_BLOCKED or TASK_FAILED commits:

```bash
git log --all --branches='task/*' --grep="TASK_" --format="%H %s"
```

## Contributing

Contributions are welcome! Please:

1. Fork the repository
2. Create a feature branch
3. Make your changes
4. Add tests
5. Submit a pull request

## License

MIT License - see LICENSE file for details

## Credits

Built with:
- [Claude agent SDK](https://github.com/anthropics/claude-agent-sdk-python)
- [Click](https://click.palletsprojects.com/) for CLI
- Git for all state management

## Vision

Flow-Claude demonstrates a fully autonomous, git-driven development approach where:

- **Git is the communication bus** between agents
- **Ultra-fine task granularity** (5-10 min) enables maximum parallelization
- **Zero information loss** via structured commit messages
- **Dependency-based agent creation** minimizes coupling
- **Dynamic replanning** handles discoveries during implementation

The result: A system that can autonomously develop software features with minimal human intervention, while maintaining complete transparency and auditability through git history.

---

**Flow-Claude v0.1.0** - Git-First Autonomous Development
