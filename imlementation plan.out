Plan: Remove plan.md/system-overview.md, Use Commit-Only Architecture

 Summary

 Remove plan.md and system-overview.md files entirely. Store all plan data (tasks, status, architecture notes) in commit messages on    
 the plan branch. This makes Flow-Claude truly "git-native" with commits as the single source of truth.

 Architecture Change

 Before (File-Based)

 plan/session-20250115-143000
 ├── Commit 1: "Create plan"
 │   └── Files: plan.md, system-overview.md
 ├── Commit 2: "Update plan after Wave 1"
 │   └── Files: plan.md (edited), system-overview.md (edited)

 After (Commit-Only)

 plan/session-20250115-143000
 ├── Commit 1: "Initialize execution plan v1"
 │   └── Message: Full plan + architecture in structured format
 ├── Commit 2: "Update plan: Wave 1 complete"
 │   └── Message: Full plan with updated task statuses + architecture learnings

 Agents read with: mcp__git__parse_plan({"branch": "plan/..."}) → Returns structured JSON

 Benefits

 ✅ Git-native: Commits are immutable, versioned, single source of truth
 ✅ Simpler tools: Remove mcp__git__read_plan_file (3 tools instead of 4)
 ✅ Structured data: Agents get JSON instead of parsing markdown files
 ✅ Activates parse_plan_commit(): The unused parser function finally gets used!
 ✅ Better history: Can see plan evolution through commit messages

 Changes Required

 1. Extend parsers.py (50 lines)

 File: flow_claude/parsers.py lines 238-306

 Add architecture section extraction to parse_plan_commit():
 return {
     'session_id': ...,
     'user_request': ...,
     'architecture': sections.get('architecture', ''),
     'design_patterns': sections.get('design_patterns', ''),
     'technology_stack': sections.get('technology_stack', ''),
     'tasks': tasks,
     'total_tasks': len(tasks),
     'estimated_total_time': ...,
 }

 2. Update planner.md (50 lines)

 File: prompts/planner.md

 Phase 1 (lines 210-268):
 - Remove: Write: plan.md and Write: system-overview.md
 - Add: Generate structured commit message with:
   - ## Session Information
   - ## Architecture
   - ## Design Patterns
   - ## Technology Stack
   - ## Tasks (all tasks with status=pending)
   - ## Estimates
   - ## Dependency Graph

 Phase 4 (lines 385-412):
 - Remove: git checkout plan && Edit: plan.md && Edit: system-overview.md
 - Add: Generate new commit with updated plan (mark completed tasks, update architecture notes)

 Phase 5 (lines 508-530): Same as Phase 4

 Tool docs (lines 717-723, 798-799):
 - Remove: mcp__git__read_plan_file documentation and rules

 3. Update orchestrator.md (10 lines)

 File: prompts/orchestrator.md

 Lines 62-69: Replace git show plan/{branch}:plan.md with:
 mcp__git__parse_plan({"branch": "plan/session-YYYYMMDD-HHMMSS"})
 # Returns: {"tasks": [...], "architecture": "...", ...}

 Lines 197-198: Replace grep "status.*pending" with checking JSON:
 plan = mcp__git__parse_plan({"branch": "..."})
 pending_tasks = [t for t in plan["tasks"] if t["status"] == "pending"]

 Lines 44, 221-222, 248-249: Update planner instructions (commit messages, not files)

 4. Update worker.md (10 lines)

 File: prompts/worker.md

 Lines 101-114 (Step 2): Replace:
 git show plan/{branch}:system-overview.md
 git show plan/{branch}:plan.md

 With:
 plan = mcp__git__parse_plan({"branch": "plan/session-YYYYMMDD-HHMMSS"})
 # Access: plan["architecture"], plan["design_patterns"], plan["tasks"]

 5. Remove mcp__git__read_plan_file (110 lines)

 File: flow_claude/git_tools.py

 - Remove: read_plan_file() function (lines 294-401)
 - Update: create_git_tools_server() line 426 - remove from tools list
 - Result: Only 3 tools remain: parse_task, parse_plan, get_provides

 6. Update DESIGN_MCP_OPTIMIZATION.md

 File: DESIGN_MCP_OPTIMIZATION.md

 Update design doc to reflect commit-only architecture and removal of mcp__git__read_plan_file

 Implementation Order

 1. Phase 1: Extend parsers.py to extract architecture sections
 2. Phase 2: Update planner.md to write commit messages instead of files
 3. Phase 3: Update orchestrator.md to use mcp__git__parse_plan
 4. Phase 4: Update worker.md to use mcp__git__parse_plan
 5. Phase 5: Remove mcp__git__read_plan_file from git_tools.py
 6. Phase 6: Update documentation

 Testing Strategy

 After each phase:
 1. Run simple test: flow-claude develop "add hello world function"
 2. Verify planner writes commit messages correctly
 3. Verify orchestrator reads commits correctly
 4. Verify workers access architecture from commits
 5. Confirm parse_plan_commit() is called (check logs if needed)

 Risks

 ⚠️ Larger commits: ~500-1000 lines vs ~200 lines (git handles fine)
 ⚠️ Planner complexity: Must regenerate entire plan per commit (not just edit)
 ⚠️ Migration: Old test repos with plan.md files won't work (fresh start needed)

 Files Modified

 1. flow_claude/parsers.py (~50 lines changed)
 2. prompts/planner.md (~50 lines changed)
 3. prompts/orchestrator.md (~10 lines changed)
 4. prompts/worker.md (~10 lines changed)
 5. flow_claude/git_tools.py (~110 lines removed)
 6. DESIGN_MCP_OPTIMIZATION.md (updated)

 Total: ~240 lines changed/removed
